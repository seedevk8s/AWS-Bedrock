<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1200">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 22px; font-weight: bold; fill: #232f3e; }
      .subtitle { font-family: Arial, sans-serif; font-size: 13px; fill: #545b64; }
      .label { font-family: Arial, sans-serif; font-size: 12px; fill: #232f3e; font-weight: 600; }
      .small-label { font-family: Arial, sans-serif; font-size: 10px; fill: #545b64; }
      .code { font-family: 'Courier New', monospace; font-size: 9px; fill: #232f3e; }
      .aws-orange { fill: #ff9900; }
      .aws-blue { fill: #527fff; }
      .aws-green { fill: #1e8900; }
      .aws-purple { fill: #b366ff; }
      .aws-red { fill: #d13212; }
      .box { fill: #ffffff; stroke: #545b64; stroke-width: 2; rx: 8; }
      .process-box { fill: #e6f2ff; stroke: #232f3e; stroke-width: 2; rx: 8; }
      .decision-box { fill: #fff5e6; stroke: #ff9900; stroke-width: 2; }
      .code-box { fill: #f5f5f5; stroke: #879596; stroke-width: 1.5; rx: 4; }
      .arrow { fill: none; stroke: #232f3e; stroke-width: 2.5; marker-end: url(#arrowhead); }
      .error-arrow { fill: none; stroke: #d13212; stroke-width: 2.5; marker-end: url(#arrowhead-error); stroke-dasharray: 5,5; }
      .success-arrow { fill: none; stroke: #1e8900; stroke-width: 2.5; marker-end: url(#arrowhead-success); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#232f3e" />
    </marker>
    <marker id="arrowhead-error" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#d13212" />
    </marker>
    <marker id="arrowhead-success" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1e8900" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" class="title">bedrock.py Execution Flow</text>
  <text x="500" y="48" text-anchor="middle" class="subtitle">AWS Bedrock Titan Text Generation Process</text>

  <!-- Step 1: Import Libraries -->
  <rect class="process-box" x="350" y="70" width="300" height="60"/>
  <text x="500" y="93" text-anchor="middle" class="label">1. Import Libraries</text>
  <text x="500" y="108" text-anchor="middle" class="small-label">boto3, json, botocore</text>
  <text x="500" y="120" text-anchor="middle" class="code">import boto3, json</text>

  <!-- Step 2: Initialize Client -->
  <rect class="process-box" x="350" y="160" width="300" height="70"/>
  <text x="500" y="183" text-anchor="middle" class="label">2. Initialize Bedrock Client</text>
  <text x="500" y="198" text-anchor="middle" class="small-label">Region: us-east-1</text>
  <rect class="code-box" x="365" y="205" width="270" height="18"/>
  <text x="500" y="217" text-anchor="middle" class="code">boto3.client("bedrock-runtime")</text>

  <!-- Step 3: Configure Model -->
  <rect class="process-box" x="350" y="260" width="300" height="90"/>
  <text x="500" y="283" text-anchor="middle" class="label">3. Configure Model &amp; Parameters</text>
  <text x="500" y="298" text-anchor="middle" class="small-label">Model: amazon.titan-text-premier-v1:0</text>
  <rect class="code-box" x="365" y="305" width="270" height="38"/>
  <text x="500" y="317" text-anchor="middle" class="code">maxTokenCount: 512</text>
  <text x="500" y="329" text-anchor="middle" class="code">temperature: 0.5</text>

  <!-- Step 4: Create Request -->
  <rect class="process-box" x="350" y="380" width="300" height="80"/>
  <text x="500" y="403" text-anchor="middle" class="label">4. Build Request Payload</text>
  <rect class="code-box" x="365" y="410" width="270" height="43"/>
  <text x="500" y="422" text-anchor="middle" class="code">native_request = {</text>
  <text x="500" y="432" text-anchor="middle" class="code">  "inputText": prompt,</text>
  <text x="500" y="442" text-anchor="middle" class="code">  "textGenerationConfig": {...}</text>
  <text x="500" y="452" text-anchor="middle" class="code">}</text>

  <!-- Step 5: Invoke Model -->
  <rect class="aws-orange" x="350" y="490" width="300" height="70"/>
  <text x="500" y="513" text-anchor="middle" class="label" fill="white">5. Invoke AWS Bedrock API</text>
  <text x="500" y="528" text-anchor="middle" class="small-label" fill="white">invoke_model(modelId, body)</text>
  <rect x="365" y="535" width="270" height="18" fill="rgba(255,255,255,0.2)" stroke="none" rx="4"/>
  <text x="500" y="547" text-anchor="middle" class="code" fill="white">POST â†’ bedrock-runtime.us-east-1</text>

  <!-- AWS Bedrock Service -->
  <rect class="box" x="100" y="600" width="800" height="120" fill="#f9f9f9" stroke="#ff9900" stroke-width="3"/>
  <text x="500" y="625" text-anchor="middle" class="label" style="font-size: 14px;">AWS Bedrock Runtime Service</text>

  <rect class="aws-purple" x="150" y="640" width="250" height="60"/>
  <text x="275" y="663" text-anchor="middle" class="label" fill="white">Titan Text Premier v1:0</text>
  <text x="275" y="678" text-anchor="middle" class="small-label" fill="white">Foundation Model</text>
  <text x="275" y="690" text-anchor="middle" class="small-label" fill="white">Text Generation</text>

  <rect class="aws-green" x="450" y="640" width="200" height="60"/>
  <text x="550" y="663" text-anchor="middle" class="label" fill="white">Model Inference</text>
  <text x="550" y="678" text-anchor="middle" class="small-label" fill="white">Process Input</text>
  <text x="550" y="690" text-anchor="middle" class="small-label" fill="white">Generate Output</text>

  <rect class="aws-blue" x="700" y="640" width="150" height="60"/>
  <text x="775" y="663" text-anchor="middle" class="label" fill="white">Response</text>
  <text x="775" y="678" text-anchor="middle" class="small-label" fill="white">JSON Format</text>
  <text x="775" y="690" text-anchor="middle" class="small-label" fill="white">outputText</text>

  <!-- Decision: Success or Error -->
  <polygon class="decision-box" points="500,750 600,790 500,830 400,790" />
  <text x="500" y="790" text-anchor="middle" class="label">Success?</text>
  <text x="500" y="803" text-anchor="middle" class="small-label">Status Code</text>

  <!-- Error Path -->
  <rect class="box" x="150" y="870" width="200" height="80" fill="#ffe6e6" stroke="#d13212"/>
  <text x="250" y="893" text-anchor="middle" class="label" style="fill: #d13212;">Error Handler</text>
  <text x="250" y="908" text-anchor="middle" class="small-label">ClientError / Exception</text>
  <rect class="code-box" x="165" y="915" width="170" height="28"/>
  <text x="250" y="927" text-anchor="middle" class="code">print(f"ERROR: {e}")</text>
  <text x="250" y="939" text-anchor="middle" class="code">exit(1)</text>

  <!-- Success Path -->
  <rect class="process-box" x="650" y="870" width="200" height="80" fill="#e6ffe6"/>
  <text x="750" y="893" text-anchor="middle" class="label">6. Parse Response</text>
  <rect class="code-box" x="665" y="900" width="170" height="43"/>
  <text x="750" y="912" text-anchor="middle" class="code">response["body"].read()</text>
  <text x="750" y="922" text-anchor="middle" class="code">json.loads()</text>
  <text x="750" y="932" text-anchor="middle" class="code">results[0]["outputText"]</text>

  <!-- Output -->
  <rect class="aws-green" x="650" y="980" width="200" height="60"/>
  <text x="750" y="1003" text-anchor="middle" class="label" fill="white">7. Print Output</text>
  <text x="750" y="1018" text-anchor="middle" class="small-label" fill="white">Display Generated Text</text>
  <text x="750" y="1030" text-anchor="middle" class="code" fill="white">print(response_text)</text>

  <!-- Exit Error -->
  <rect class="aws-red" x="150" y="980" width="200" height="60"/>
  <text x="250" y="1003" text-anchor="middle" class="label" fill="white">Exit with Error</text>
  <text x="250" y="1018" text-anchor="middle" class="small-label" fill="white">Status Code: 1</text>

  <!-- Arrows -->
  <path class="arrow" d="M 500 130 L 500 160"/>
  <path class="arrow" d="M 500 230 L 500 260"/>
  <path class="arrow" d="M 500 350 L 500 380"/>
  <path class="arrow" d="M 500 460 L 500 490"/>
  <path class="arrow" d="M 500 560 L 500 600"/>

  <!-- AWS Service Internal Flow -->
  <path class="arrow" d="M 275 640 L 275 620 L 550 620 L 550 640" stroke="#ff9900" stroke-width="2"/>
  <path class="arrow" d="M 550 640 L 550 625 L 775 625 L 775 640" stroke="#ff9900" stroke-width="2"/>

  <path class="arrow" d="M 500 720 L 500 750"/>

  <!-- Decision Arrows -->
  <path class="error-arrow" d="M 400 790 L 250 790 L 250 870"/>
  <text x="320" y="785" class="small-label" fill="#d13212">Error</text>

  <path class="success-arrow" d="M 600 790 L 750 790 L 750 870"/>
  <text x="680" y="785" class="small-label" fill="#1e8900">Success</text>

  <!-- Final Arrows -->
  <path class="arrow" d="M 750 950 L 750 980"/>
  <path class="arrow" d="M 250 950 L 250 980"/>

  <!-- Legend -->
  <rect x="50" y="1080" width="900" height="90" fill="#f9f9f9" stroke="#879596" stroke-width="1" rx="5"/>
  <text x="70" y="1100" class="label">Key Components:</text>

  <rect class="process-box" x="70" y="1110" width="100" height="30"/>
  <text x="120" y="1130" text-anchor="middle" class="small-label">Process Step</text>

  <rect class="aws-orange" x="190" y="1110" width="100" height="30"/>
  <text x="240" y="1130" text-anchor="middle" class="small-label" fill="white">AWS API Call</text>

  <polygon class="decision-box" points="330,1110 380,1125 330,1140 280,1125"/>
  <text x="330" y="1130" text-anchor="middle" class="small-label">Decision</text>

  <rect x="400" y="1110" width="100" height="30" fill="#e6ffe6" stroke="#1e8900" stroke-width="2" rx="8"/>
  <text x="450" y="1130" text-anchor="middle" class="small-label">Success Path</text>

  <rect x="520" y="1110" width="100" height="30" fill="#ffe6e6" stroke="#d13212" stroke-width="2" rx="8"/>
  <text x="570" y="1130" text-anchor="middle" class="small-label">Error Path</text>

  <text x="70" y="1160" class="small-label">Prompt: "Describe the purpose of a 'hello world' program in one line."</text>
</svg>
